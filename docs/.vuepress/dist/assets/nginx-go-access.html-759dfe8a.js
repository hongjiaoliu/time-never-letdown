import{_ as t,V as l,W as c,X as s,Y as n,$ as e,Z as i,F as o}from"./framework-e5211252.js";const r={},d=s("h1",{id:"nginx-6-go-access-分析日志",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#nginx-6-go-access-分析日志","aria-hidden":"true"},"#"),n(" Nginx | 6-Go Access 分析日志")],-1),p=s("h1",{id:"一-下载",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#一-下载","aria-hidden":"true"},"#"),n(" 一：下载")],-1),u={href:"https://goaccess.io/download",target:"_blank",rel:"noopener noreferrer"},m=i(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">wget</span> https://tar.goaccess.io/goaccess-1.5.6.tar.gz
$ <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> goaccess-1.5.6.tar.gz
$ <span class="token builtin class-name">cd</span> goaccess-1.5.6/
$ ./configure --enable-utf8 --enable-geoip<span class="token operator">=</span>mmdb
$ <span class="token function">make</span>
<span class="token comment"># make install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行第4步，报错 Missing development files for libmaxminddb library（--enable-geoip=mmdb依赖项） 原因是未安装libmaxminddb</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">wget</span> https://github.com/maxmind/libmaxminddb/releases/download/1.6.0/libmaxminddb-1.6.0.tar.gz
$ <span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> libmaxminddb-1.6.0.tar.gz
$ <span class="token builtin class-name">cd</span> libmaxminddb-1.6.0
$ ./configure
$ <span class="token function">make</span>
$ <span class="token function">make</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后重新执行第4步，操作如下： configure: error: *** Missing development libraries for ncursesw（--enable-utf8依赖项） 原因是没有安装ncursesw</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> ncurses-devel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再次执行第4步，成功</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Your build configuration:

  Prefix         <span class="token builtin class-name">:</span> /usr/local
  Package        <span class="token builtin class-name">:</span> goaccess
  Version        <span class="token builtin class-name">:</span> <span class="token number">1.5</span>.6
  Compiler flags <span class="token builtin class-name">:</span>  <span class="token parameter variable">-pthread</span>
  Linker flags   <span class="token builtin class-name">:</span> <span class="token parameter variable">-lnsl</span> <span class="token parameter variable">-lncursesw</span> <span class="token parameter variable">-lmaxminddb</span> <span class="token parameter variable">-lpthread</span>  
  UTF-8 support  <span class="token builtin class-name">:</span> <span class="token function">yes</span>
  Dynamic buffer <span class="token builtin class-name">:</span> no
  Geolocation    <span class="token builtin class-name">:</span> GeoIP2
  Storage method <span class="token builtin class-name">:</span> In-Memory with On-Disk Persistent Storage
  TLS/SSL        <span class="token builtin class-name">:</span> no
  Bugs           <span class="token builtin class-name">:</span> hello@goaccess.io
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后执行第5步，报错</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>make: *** <span class="token punctuation">[</span>src/tpls.h<span class="token punctuation">]</span> Error <span class="token number">127</span>
<span class="token punctuation">[</span>root@liuhongjiao goaccess-1.5.6<span class="token punctuation">]</span><span class="token comment"># sudo make </span>
<span class="token function">cat</span> ./resources/tpls.html <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&quot;s/^[[:space:]]*//&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&quot;/^$/d&quot;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;<span class="token entity" title="\\r">\\r</span><span class="token entity" title="\\n">\\n</span>&quot;</span> <span class="token operator">&gt;</span> ./resources/tpls.html.tmp
./bin2c ./resources/tpls.html.tmp src/tpls.h tpls
./bin2c: error <span class="token keyword">while</span> loading shared libraries: libmaxminddb.so.0: cannot <span class="token function">open</span> shared object file: No such <span class="token function">file</span> or directory
make: *** <span class="token punctuation">[</span>src/tpls.h<span class="token punctuation">]</span> Error <span class="token number">127</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),b={href:"https://www.yuque.com/maohou/wkdvge/tqprdn",target:"_blank",rel:"noopener noreferrer"},h=i(`<p>然后重新执行第5步，成功 然后执行第6步，成功</p><p>至此，go access 安装成功</p><h1 id="二、使用" tabindex="-1"><a class="header-anchor" href="#二、使用" aria-hidden="true">#</a> 二、使用</h1><h2 id="_1、生成report-html" tabindex="-1"><a class="header-anchor" href="#_1、生成report-html" aria-hidden="true">#</a> 1、生成report.html</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>goaccess logs/access.log <span class="token parameter variable">-o</span> html/report.html --real-time-html --time-format<span class="token operator">=</span><span class="token string">&#39;%H:%M:%S&#39;</span> --date-format<span class="token operator">=</span><span class="token string">&#39;d%/%b/%Y&#39;</span> --log-format<span class="token operator">=</span>COMBINED
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>执行结果：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token punctuation">[</span>PARSING logs/access.log<span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> @ <span class="token punctuation">{</span><span class="token number">0</span>/s<span class="token punctuation">}</span>
WebSocket server ready to accept new client connections
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2、配置report-html代理" tabindex="-1"><a class="header-anchor" href="#_2、配置report-html代理" aria-hidden="true">#</a> 2、配置report.html代理</h2><p>打开日志配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
                      <span class="token string">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
                      <span class="token string">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span><span class="token punctuation">;</span>

access_log  logs/access.log  main<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置代理</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>location /report.html <span class="token punctuation">{</span>
            <span class="token builtin class-name">alias</span> /usr/local/nginx/html/report.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3、goaccess界面" tabindex="-1"><a class="header-anchor" href="#_3、goaccess界面" aria-hidden="true">#</a> 3、goaccess界面</h2><figure><img src="https://cdn.liuhongjiao.cn/images/2023/02/13/nginx-go-access/1676250082877.png" alt="图 1" tabindex="0" loading="lazy"><figcaption>图 1</figcaption></figure><h2 id="遗留问题" tabindex="-1"><a class="header-anchor" href="#遗留问题" aria-hidden="true">#</a> 遗留问题：</h2><h3 id="_1、发现参数-real-time-html无法实时刷新html" tabindex="-1"><a class="header-anchor" href="#_1、发现参数-real-time-html无法实时刷新html" aria-hidden="true">#</a> 1、发现参数-real-time-html无法实时刷新html</h3>`,16),v={href:"https://blog.csdn.net/m0_37732829/article/details/117999475",target:"_blank",rel:"noopener noreferrer"};function g(k,f){const a=o("ExternalLinkIcon");return l(),c("div",null,[d,p,s("p",null,[n("地址："),s("a",u,[n("https://goaccess.io/download"),e(a)])]),m,s("p",null,[n("核心报错是：./bin2c: error while loading shared libraries: libmaxminddb.so.0: cannot open shared object file: No such file or directory 原因：执行某些外部程序的时候可能会提示找不到共享库的错误 解决方案："),s("a",b,[n("系统问题-3"),e(a)])]),h,s("p",null,[n("默认goaccess在开启实时real-time-html后会监听端口7890的websocket，如果服务器不允许请求7890端口，你就看不到那个页面是实时更新的——你会发现访问的页面最后更新时间始终不变。这一点人很多忽略了，很多人以为是哪个生成html静态文件是实时更新的，其实根本不是，那个文件本身一旦生成就不动了，真正更新的实时内容是从websocket过来的 "),s("a",v,[e(a)])])])}const x=t(r,[["render",g],["__file","nginx-go-access.html.vue"]]);export{x as default};
